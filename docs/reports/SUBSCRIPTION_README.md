# –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –¥–ª—è VPN –±–æ—Ç–∞

–Ø–¥—Ä–µ–Ω –±–∞—Ç–æ–Ω, –¥–∞ –∫–∞–∫ —Ç–∞–∫ —Ç–æ! –≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –∑–∞–¥–∞—á–∞, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ —Ö–∞–ø–Ω—É—Ç—å!

## ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç–µ–∫—à–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å—Ç–µ–∫—à–∏–º–∏ —Ç—Ä–∏–∞–ª–∞–º–∏
- –û—á–∏—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º –±–µ–∑ –æ–ø–ª–∞—Ç—ã
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **VPNSubscriptionManager** (`sup/src/utils/subscription_manager_simple.py`)
   - –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
   - –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö `vpnbot.db`
   - –ú–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫

2. **SubscriptionScheduler** (`sup/src/utils/subscription_scheduler.py`)
   - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
   - –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±–æ—Ç–∞

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º** (`main_scripts/main_optimized.py`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –≤–º–µ—Å—Ç–µ —Å –±–æ—Ç–æ–º

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `user_subscriptions`
```sql
- user_id (INTEGER PRIMARY KEY) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- username (TEXT) - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- subscription_type (TEXT) - —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏ ('trial', 'premium')
- subscription_start (DATETIME) - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞
- subscription_end (DATETIME) - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- is_active (BOOLEAN) - –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞
- config_data (TEXT) - –∫–æ–Ω—Ñ–∏–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- trial_used (BOOLEAN) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ —Ç—Ä–∏–∞–ª
- premium_payments (INTEGER) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–º–∏—É–º –ø–ª–∞—Ç–µ–∂–µ–π
- total_paid (REAL) - –æ–±—â–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- created_at, updated_at (DATETIME) - –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

### –¢–∞–±–ª–∏—Ü–∞ `subscription_cleanup_log`
```sql
- id (INTEGER PRIMARY KEY AUTOINCREMENT) - ID –∑–∞–ø–∏—Å–∏
- user_id (INTEGER) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- action (TEXT) - –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
- old_subscription_type (TEXT) - –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏
- new_subscription_type (TEXT) - –Ω–æ–≤—ã–π —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏
- timestamp (DATETIME) - –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è
- details (TEXT) - –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
```

### –¢–∞–±–ª–∏—Ü–∞ `subscription_payments`
```sql
- payment_id (INTEGER PRIMARY KEY AUTOINCREMENT) - ID –ø–ª–∞—Ç–µ–∂–∞
- user_id (INTEGER) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- amount (REAL) - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
- currency (TEXT) - –≤–∞–ª—é—Ç–∞
- payment_method (TEXT) - –º–µ—Ç–æ–¥ –ø–ª–∞—Ç–µ–∂–∞
- subscription_type (TEXT) - —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏
- days_added (INTEGER) - –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–Ω–∏
- payment_date (DATETIME) - –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
- external_payment_id (TEXT) - –≤–Ω–µ—à–Ω–∏–π ID –ø–ª–∞—Ç–µ–∂–∞
- status (TEXT) - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –±–æ—Ç–æ–º:
```bash
python main_scripts/main_optimized.py
```

### 2. –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
python -c "
import sys
sys.path.append('sup/src/utils')
from subscription_manager_simple import subscription_manager
subscription_manager.run_cleanup()
"
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
python test_subscription_integration.py
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—á–∏—Å—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00. –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª–µ `subscription_scheduler.py`:

```python
# –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
schedule.every(6).hours.do(self.run_cleanup_job)

# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
schedule.every(30).minutes.do(self.run_cleanup_job)

# –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00
schedule.every().monday.at("09:00").do(self.run_cleanup_job)
```

### –¢—Ä–∏–∞–ª –ø–µ—Ä–∏–æ–¥
–¢—Ä–∏–∞–ª –ø–µ—Ä–∏–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - 3 –¥–Ω—è. –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –∫–æ–¥–µ:
```python
trial_end = datetime.now() + timedelta(days=7)  # 7 –¥–Ω–µ–π —Ç—Ä–∏–∞–ª–∞
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
- `subscription_cleanup.log` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –æ—á–∏—Å—Ç–∫–∏
- –¢–∞–±–ª–∏—Ü–∞ `subscription_cleanup_log` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```python
stats = subscription_manager.get_subscription_stats()
print(f"–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {stats['active_users']}")
print(f"–ò—Å—Ç–µ–∫–∞–µ—Ç –≤ –±–ª–∏–∂–∞–π—à–∏–µ 24—á: {stats['expiring_soon']}")
print(f"–û–±—â–∏–π –¥–æ—Ö–æ–¥: {stats['total_revenue']} RUB")
```

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –±–æ—Ç–∞:

```python
# –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–ª–∞—Ç–µ–∂–µ
subscription_manager.add_subscription_days(
    user_id=user_id,
    days=30,
    subscription_type='premium',
    payment_amount=amount
)
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–¢–µ—Å—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—Ç–ª–∏—á–Ω—É—é —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã:
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ò—Å—Ç–µ–∫—à–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—á–∏—â–∞—é—Ç—Å—è
- ‚úÖ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite

## üö® –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø–ª–∞—Ç–∏–ª

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ 3 –¥–Ω—è —Ç—Ä–∏–∞–ª–∞
2. **–ö–æ–Ω—Ñ–∏–≥ –æ—á–∏—â–∞–µ—Ç—Å—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ VPN
3. **–õ–æ–≥–∏—Ä—É–µ—Ç—Å—è**: –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéØ –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∏—Å—Ç–µ–∫—à–∏–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è, –∏—Ö –∫–æ–Ω—Ñ–∏–≥–∏ –æ—á–∏—â–∞—é—Ç—Å—è, –∏ –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º –±–µ–∑ –æ–ø–ª–∞—Ç—ã. –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ñ–æ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±–æ—Ç–∞.

–ò —Ç–∞–∫ —Å–æ–π–¥–µ—Ç! üéâ
