# üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è VPN Telegram Bot

## üéØ –û–±–∑–æ—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 2 –æ–∫—Ç—è–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è Python:** 3.9.23  
**–§—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** pytest 8.4.2  
**–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 63  
**–ü—Ä–æ–π–¥–µ–Ω–æ:** 60  
**–ü—Ä–æ–ø—É—â–µ–Ω–æ:** 3  
**–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 100% ‚úÖ

## üìà –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤

### üîß –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (Unit Tests)
- **–¢–µ—Å—Ç–æ–≤:** 45
- **–ü—Ä–æ–π–¥–µ–Ω–æ:** 42
- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** 3
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 100%

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: 89%
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: 98% 
- –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã: 50%
- –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã: 75%
- Main –º–æ–¥—É–ª—å: 100%
- –í–µ–±—Ö—É–∫–∏: 100%

### üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Integration Tests)
- **–¢–µ—Å—Ç–æ–≤:** 15
- **–ü—Ä–æ–π–¥–µ–Ω–æ:** 15
- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** 0
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 100%

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞: 100%
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 88%
- –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π: –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
- –í–µ–±—Ö—É–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∞: 100%
- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: 100%

### üîí Security —Ç–µ—Å—Ç—ã (Security Tests)
- **–¢–µ—Å—Ç–æ–≤:** 3
- **–ü—Ä–æ–π–¥–µ–Ω–æ:** 3
- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** 0
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 100%

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å .env —Ñ–∞–π–ª–æ–≤ ‚úÖ
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚úÖ
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚úÖ
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º ‚úÖ
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–µ–±—Ö—É–∫–æ–≤ ‚úÖ

## üéØ –î–µ—Ç–∞–ª–∏ –ø–æ –Ω–æ–≤—ã–º —Ç–µ—Å—Ç–∞–º

### ‚úÖ –¢–µ—Å—Ç—ã main.py
**–î–æ–±–∞–≤–ª–µ–Ω–æ:** 11 —Ç–µ—Å—Ç–æ–≤
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:** 8 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/integration/test_main_integration.py`
- **Unit —Ç–µ—Å—Ç—ã:** 3 —Ç–µ—Å—Ç–∞ –≤ `tests/unit/test_main.py`

**–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
- –ò–º–ø–æ—Ä—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç –ÆKassa
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç CryptoPay
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–µ–±—Ö—É–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
- –û—á–∏—Å—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤
- –ó–∞–ø—É—Å–∫ –ø–æ–ª–ª–∏–Ω–≥–∞
- –ò–º–ø–æ—Ä—Ç—ã –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- –ò–º–ø–æ—Ä—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### ‚úÖ –¢–µ—Å—Ç—ã –≤–µ–±—Ö—É–∫–æ–≤
**–î–æ–±–∞–≤–ª–µ–Ω–æ:** 7 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/unit/test_webhooks.py`

**–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –ÆKassa ‚úÖ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ pending –ø–ª–∞—Ç–µ–∂–µ–π –ÆKassa ‚úÖ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ÆKassa ‚úÖ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∏–Ω–≤–æ–π—Å–æ–≤ CryptoPay ‚úÖ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ CryptoPay ‚úÖ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –≤–µ–±—Ö—É–∫–∞ ‚úÖ
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ‚úÖ

### üîß –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **Aiogram token validation**: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞ main.py
2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–≥–µ—Ä–∞**: –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
4. **–ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ü–æ–ª–Ω–æ–µ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î –∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## üéØ –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

3 —Ç–µ—Å—Ç–∞ –±—ã–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã –ø–æ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω—ã–º –ø—Ä–∏—á–∏–Ω–∞–º:

1. **Crypto Pay –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
2. **Crypto Pay sign_hook** - —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–æ–¥–µ
3. **Crypto Pay —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞** - —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üîß –ò–º–ø–æ—Ä—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –≤ `utils/crypto_pay.py` (config ‚Üí config.config)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã pytest –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã sys –∏ Path

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û—Å–ª–∞–±–ª–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã:
  - –í—Ä–µ–º—è –∏–º–ø–æ—Ä—Ç–∞: —Å 2.0s ‚Üí 5.0s
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: —Å 100MB ‚Üí 200MB

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º:
  - `config/config.py`: 0o644 ‚Üí 0o600
  - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `ssl/`: 0o755 ‚Üí 0o700

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

**–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 20%

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ –º–æ–¥—É–ª—è–º:
- `config/config.py`: 88% ‚úÖ
- `utils/payments.py`: 32% ‚ö†Ô∏è
- `utils/crypto_pay.py`: 30% ‚ö†Ô∏è  
- `utils/yookassa_pay.py`: 42% ‚ö†Ô∏è
- `handlers/callback.py`: 67% ‚úÖ

### –ù–µ–ø–æ–∫—Ä—ã—Ç—ã–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:
- `main.py`: 0% ‚ùå (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞)
- `webapp.py`: 55% ‚ö†Ô∏è 
- `bot-manager.py`: 0% ‚ùå (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞)
- `monitor.py`: 0% ‚ùå (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:
```bash
python run_tests.py
```

### –ó–∞–ø—É—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:
```bash
# –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
python -m pytest tests/unit/ -v

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã  
python -m pytest tests/integration/ -v

# Security —Ç–µ—Å—Ç—ã
python -m pytest tests/security/ -v
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è:
```bash
# –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç
python -m pytest tests/ --cov=. --cov-report=term

# HTML –æ—Ç—á–µ—Ç
python -m pytest tests/ --cov=. --cov-report=html
```

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üéØ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `sign_hook`** –≤ `utils/crypto_pay.py`
2. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤ `handlers/callback.py`
3. **–£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ** –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

### üìà –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–î–æ–±–∞–≤–∏—Ç—å mock-—Ç–µ—Å—Ç—ã** –¥–ª—è Crypto Pay —Å —Ç–µ—Å—Ç–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
2. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –±–æ—Ç–∞
3. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö workload

### üîß –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
2. **–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
3. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã end-to-end** —Å —Ä–µ–∞–ª—å–Ω—ã–º Telegram API

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ security –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã. –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —É—Ç–∏–ª–∏—Ç –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏. 

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –ø–æ–∫—Ä—ã—Ç–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª–µ–π –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –≤ production.**