# Настройка вебхука YooKassa

Для автоматической активации подписки после оплаты необходимо настроить вебхук в личном кабинете YooKassa.

## Шаги настройки:

1. **Войдите в личный кабинет YooKassa**
   - Перейдите на https://yookassa.ru
   - Авторизуйтесь под своим аккаунтом

2. **Перейдите в настройки магазина**
   - Выберите ваш магазин (ID: 1123779)
   - Перейдите в раздел "Настройки" → "Уведомления"

3. **Настройте вебхук**
   - URL вебхука: `https://vpn.chillcreative.ru/yookassa_webhook`
   - Типы событий: выберите "Все события" или минимум:
     - `payment.succeeded` - успешная оплата
     - `payment.canceled` - отмена оплаты
     - `payment.waiting_for_capture` - ожидание подтверждения

4. **Проверьте настройки**
   - Убедитесь, что вебхук активен
   - Проверьте, что URL указан правильно

## Важные моменты:

- YooKassa отправляет уведомления методом POST с JSON телом
- Наш сервер уже настроен для обработки этих уведомлений
- Вебхук должен быть доступен из интернета (проверено: ✅)
- Nginx проксирует запросы на наш бот на порту 8001

## Проверка работы:

После настройки вебхука можно проверить его работу:

1. Создать тестовый платеж через бота
2. YooKassa отправит уведомление на наш вебхук
3. Система автоматически активирует подписку
4. Пользователь получит уведомление в Telegram

## Логирование:

Все операции логируются в:
- `logs/bot.log` - основные события бота
- `logs/webhook.log` - вебхук запросы (если настроено)

## Безопасность:

- YooKassa подписывает запросы HMAC-SHA256
- Наш обработчик проверяет подпись запросов
- Используется HTTPS для шифрования трафика